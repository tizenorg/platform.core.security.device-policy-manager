@startuml
hide footbox

actor DevicePolicyContext
DevicePolicyContext --> Mainloop : Request remote method call
activate Mainloop

Mainloop -> Service : Event source callback
activate Service

Service -> Service : onMessageProcess
activate Service

Service -> Connection : dispatch
activate Connection

participant CallbackHolder

Connection -> Message : decode
activate Message

Message -> Socket : read
activate Socket

Message <-- Socket
deactivate Socket

Connection <-- Message
deactivate Message

Service <-- Connection
deactivate Connection

Service -> CallbackHolder : dispatch
activate CallbackHolder

loop for all parameters
CallbackHolder -> CallbackHolder : buildParameters
activate CallbackHolder

CallbackHolder -> Message : disclose
activate Message

Message -> Parameter : accept
activate Parameter

Parameter -> Deserializer : visit
activate Deserializer

participant Serializer

Deserializer -> MessageBuffer : read
activate MessageBuffer

Deserializer <-- MessageBuffer
deactivate MessageBuffer

Parameter <-- Deserializer
deactivate Deserializer

Message <-- Parameter
deactivate Parameter

CallbackHolder <-- Message
deactivate Message
deactivate CallbackHolder

end

CallbackHolder -> CallbackHandler : dispatch
activate CallbackHandler

CallbackHolder <-- CallbackHandler : return result of callback handler
deactivate CallbackHandler

Service <-- CallbackHolder : return result of callback handler
deactivate CallbackHolder

Service -> Message : createReplyMessage
activate Message

Service <-- Message : return reply message
deactivate Message

Service -> Message : enclose
activate Message
Message -> Parameter : accept
activate Parameter

Parameter -> Serializer : visit
activate Serializer

Serializer -> MessageBuffer : write
activate MessageBuffer

Serializer <-- MessageBuffer
deactivate MessageBuffer

Parameter <-- Serializer
deactivate Serializer

Message <-- Parameter
deactivate Parameter

Service <-- Message
deactivate Message

Service -> Connection : send
activate Connection

Connection -> Message : encode
activate Message

Message -> Socket : write
activate Socket

Message <-- Socket
deactivate Socket

Connection <-- Message
deactivate Message

Service <-- Connection
deactivate Connection

Mainloop <-- Service
deactivate Service

@enduml
